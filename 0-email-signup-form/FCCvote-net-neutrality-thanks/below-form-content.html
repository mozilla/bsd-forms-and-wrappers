<!-- =================== Below form content STARTS =================== -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://sendto.mozilla.org/page/-/protect-net-neutrality/js/parsley.min.js"></script>
<script>

(function(){
  var $bsdForm = $("#signup"); // BSD autogenerated form
  var $theForm = $("#mailinglist-signup-form"); // our beautified form
  var REDIRECT_URL = "https://sendto.mozilla.org/page/content/FCCvote-net-neutrality-share"; // no way to this value from BSD directly, have to use hardcoded url here

  // ***********************************************
  // Remove the BSD generated form from DOM
  // ***********************************************
  $(window).on("load", function () {
    // console.log(clonedForm);
    // $bsdForm.remove();
  });


  // ***********************************************
  // Parsley Settings, Form Validation, & Form Validation
  // ***********************************************

  $theForm.parsley().subscribe('parsley:form:validated', function (formInstance) {
    if (formInstance.submitEvent !== undefined) {
      formInstance.submitEvent.preventDefault();
    }
    if (!formInstance.isValid()) {
      formInstance.submitEvent.preventDefault();
      $("#one-line-error").show();
    } else {
      // ***********************************************
      // Form Submission
      // ***********************************************

      function submissionErrorHandler(XHR, textStatus, error) {
        console.log(XHR);
        console.log(textStatus);
        console.log(error);
        $('#one-line-error').text("Something seems to have gone wrong. Please try again later").show();
      }

      function submitSuccess(data, textStatus, XHR) {
        if (window.location.assign) {
          window.location.assign(REDIRECT_URL);
        } else {
          window.location = REDIRECT_URL;
        }
      }

      function submitError(XHR, textStatus, error) {
      }

      var submitTheForm = $.ajax($theForm.prop("action"), {
        type: "POST",
        data: $theForm.serializeArray(),
        statusCode: {
          400: submissionErrorHandler,
          500: submissionErrorHandler
        }

      });

      submitTheForm.error(submitError).success(submitSuccess);
    }
  });

  var toggleOneLineError = function() {
    var numErrors = $(".parsley-error").length;
    if ( numErrors > 0 ) {
      $("#one-line-error").show();
    } else {
      $("#one-line-error").hide();
    }
  };

  $theForm.find("input").on("change", toggleOneLineError);


})();

</script>


<!-- =================== Below form content ENDS =================== -->
